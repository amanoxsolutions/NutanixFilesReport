import matplotlib.pyplot as plt
from collections import defaultdict
import matplotlib.backends.backend_pdf as pdf

# Your data
data = [{'fileserver_name': 'nxfs11', 'share_name': 'test_share', 'share_size': 14.706850528717041, 'fs_information_text': 'nxfs11 has a total size of 1024.00 GiB. The used size is 16.00 GiB and available free space is 1008.00 GiB'}, {'fileserver_name': 'nxfs11', 'share_name': 'replica_test', 'share_size': 0.00012969970703125, 'fs_information_text': 'nxfs11 has a total size of 1024.00 GiB. The used size is 16.00 GiB and available free space is 1008.00 GiB'}, {'fileserver_name': 'nxfs11', 'share_name': 'test_share_nxfs12', 'share_size': 0.000152587890625, 'fs_information_text': 'nxfs11 has a total size of 1024.00 GiB. The used size is 16.00 GiB and available free space is 1008.00 GiB'}, {'fileserver_name': 'nxfs11', 'share_name': 'ptsm11_share', 'share_size': 0.000148773193359375, 'fs_information_text': 'nxfs11 has a total size of 1024.00 GiB. The used size is 16.00 GiB and available free space is 1008.00 GiB'}, {'fileserver_name': 'nxfs11', 'share_name': 'ptsm11_symlink', 'share_size': 0.12567138671875, 'fs_information_text': 'nxfs11 has a total size of 1024.00 GiB. The used size is 16.00 GiB and available free space is 1008.00 GiB'}, {'fileserver_name': 'nxfs11', 'share_name': 'test_fs_migration_share', 'share_size': 0.00012969970703125, 'fs_information_text': 'nxfs11 has a total size of 1024.00 GiB. The used size is 16.00 GiB and available free space is 1008.00 GiB'}, {'fileserver_name': 'nxfs11', 'share_name': 'test_fs_mig_share_noWORM', 'share_size': 0.00012969970703125, 'fs_information_text': 'nxfs11 has a total size of 1024.00 GiB. The used size is 16.00 GiB and available free space is 1008.00 GiB'}, {'fileserver_name': 'nxfs11', 'share_name': 'pvc-d18f8f53-bdaa-4377-8e34-fee988d3214f', 'share_size': 0.1546769142150879, 'fs_information_text': 'nxfs11 has a total size of 1024.00 GiB. The used size is 16.00 GiB and available free space is 1008.00 GiB'}, {'fileserver_name': 'nxfs11', 'share_name': 'pvc-f7f638f6-fd59-4ea9-8a42-bc99963b5aaa', 'share_size': 0.5420742034912109, 'fs_information_text': 'nxfs11 has a total size of 1024.00 GiB. The used size is 16.00 GiB and available free space is 1008.00 GiB'}, {'fileserver_name': 'nxfs11', 'share_name': 'pvc-6077d234-33ae-4034-97cd-9aac0d8c76f9', 'share_size': 0.0001220703125, 'fs_information_text': 'nxfs11 has a total size of 1024.00 GiB. The used size is 16.00 GiB and available free space is 1008.00 GiB'}, {'fileserver_name': 'nxfs11', 'share_name': 'pvc-678927e3-6f03-4e2b-99f9-8dae364d1168', 'share_size': 0.0008711814880371094, 'fs_information_text': 'nxfs11 has a total size of 1024.00 GiB. The used size is 16.00 GiB and available free space is 1008.00 GiB'}, {'fileserver_name': 'nxfs11', 'share_name': 'pvc-79ef8e0f-dec0-4084-bef4-a8210dbebd13', 'share_size': 0.0008635520935058594, 'fs_information_text': 'nxfs11 has a total size of 1024.00 GiB. The used size is 16.00 GiB and available free space is 1008.00 GiB'}, {'fileserver_name': 'nxfs11', 'share_name': 'pvc-89f5b9ca-306d-4df8-bb25-83f41514bf30', 'share_size': 0.0008635520935058594, 'fs_information_text': 'nxfs11 has a total size of 1024.00 GiB. The used size is 16.00 GiB and available free space is 1008.00 GiB'}, {'fileserver_name': 'nxfs11', 'share_name': 'pvc-c9024f77-69e6-4501-9610-cc0fa51974fd', 'share_size': 0.0008711814880371094, 'fs_information_text': 'nxfs11 has a total size of 1024.00 GiB. The used size is 16.00 GiB and available free space is 1008.00 GiB'}, {'fileserver_name': 'nxfs11', 'share_name': 'pvc-3f8df4b8-3efd-46ae-a112-903a08ed60a8', 'share_size': 0.004886627197265625, 'fs_information_text': 'nxfs11 has a total size of 1024.00 GiB. The used size is 16.00 GiB and available free space is 1008.00 GiB'}, {'fileserver_name': 'nxfs11', 'share_name': 'pvc-5dce65b1-64d4-49c7-baa9-a9673569795a', 'share_size': 0.0008635520935058594, 'fs_information_text': 'nxfs11 has a total size of 1024.00 GiB. The used size is 16.00 GiB and available free space is 1008.00 GiB'}, {'fileserver_name': 'nxfs11', 'share_name': 'pvc-8633c78e-731e-400f-9b7b-dfe62b10137e', 'share_size': 0.0001220703125, 'fs_information_text': 'nxfs11 has a total size of 1024.00 GiB. The used size is 16.00 GiB and available free space is 1008.00 GiB'}, {'fileserver_name': 'nxfs11', 'share_name': 'pvc-84748620-b4f5-41b3-b00c-20d40143a6ac', 'share_size': 0.0001220703125, 'fs_information_text': 'nxfs11 has a total size of 1024.00 GiB. The used size is 16.00 GiB and available free space is 1008.00 GiB'}, {'fileserver_name': 'nxfs11', 'share_name': 'pvc-c5984e7a-fa15-455a-aaa2-b9cf00855eb3', 'share_size': 0.0001220703125, 'fs_information_text': 'nxfs11 has a total size of 1024.00 GiB. The used size is 16.00 GiB and available free space is 1008.00 GiB'}, {'fileserver_name': 'nxfs11', 'share_name': 'pvc-dd4fb4c6-f427-43f8-ab59-e298d0517be6', 'share_size': 0.4615135192871094, 'fs_information_text': 'nxfs11 has a total size of 1024.00 GiB. The used size is 16.00 GiB and available free space is 1008.00 GiB'}, {'fileserver_name': 'nxfs11', 'share_name': 'pvc-29bfcccc-fe44-4ab9-a34e-9866cfc57e9d', 'share_size': 0.0001220703125, 'fs_information_text': 'nxfs11 has a total size of 1024.00 GiB. The used size is 16.00 GiB and available free space is 1008.00 GiB'}, {'fileserver_name': 'nxfs11', 'share_name': 'pvc-2a70cec9-8c6c-4d2d-9a26-667e88b60596', 'share_size': 0.0001220703125, 'fs_information_text': 'nxfs11 has a total size of 1024.00 GiB. The used size is 16.00 GiB and available free space is 1008.00 GiB'}, {'fileserver_name': 'nxfs11', 'share_name': 'pvc-9c1912da-9df0-42fd-a932-32d2a57f8cd4', 'share_size': 0.0001220703125, 'fs_information_text': 'nxfs11 has a total size of 1024.00 GiB. The used size is 16.00 GiB and available free space is 1008.00 GiB'}, {'fileserver_name': 'nxfs11', 'share_name': 'test_share_no_dfs', 'share_size': 0.00012969970703125, 'fs_information_text': 'nxfs11 has a total size of 1024.00 GiB. The used size is 16.00 GiB and available free space is 1008.00 GiB'}, {'fileserver_name': 'nxfs12', 'share_name': 'test_share_nxfs12', 'share_size': 0.000213623046875, 'fs_information_text': 'nxfs12 has a total size of 1024.00 GiB. The used size is 181.49 GiB and available free space is 842.51 GiB'}, {'fileserver_name': 'nxfs12', 'share_name': 'Roaming_Profiles', 'share_size': 114.25585460662842, 'fs_information_text': 'nxfs12 has a total size of 1024.00 GiB. The used size is 181.49 GiB and available free space is 842.51 GiB'}, {'fileserver_name': 'nxfs12', 'share_name': 'Roaming_Profiles_TS', 'share_size': 67.2334246635437, 'fs_information_text': 'nxfs12 has a total size of 1024.00 GiB. The used size is 181.49 GiB and available free space is 842.51 GiB'}, {'fileserver_name': 'nxfs14', 'share_name': 'test-share-worm-nicolas', 'share_size': 0.9762763977050781, 'fs_information_text': 'nxfs14 has a total size of 1024.00 GiB. The used size is 1.01 GiB and available free space is 1022.99 GiB'}, {'fileserver_name': 'nxfs14', 'share_name': 'hycu-11-share', 'share_size': 0.03235149383544922, 'fs_information_text': 'nxfs14 has a total size of 1024.00 GiB. The used size is 1.01 GiB and available free space is 1022.99 GiB'}]

# Group data by file server name
fileserver_data = defaultdict(list)
fileserver_text = defaultdict(list)
fileserver_used_size = defaultdict(list)
fileserver_free_space = defaultdict(list)

for d in data:
    fileserver_data[d['fileserver_name']].append(d)
    fileserver_text[d['fs_information_text']].append(d)

print(fileserver_text)

# Create a PDF file to save all charts
pdf_pages = pdf.PdfPages("share_distribution.pdf")

# Plot pie charts for each file server
for fileserver, fileserver_data in fileserver_data.items():
    share_names = [f"{d['share_name']} ({d['share_size']:.2f} GiB)" for d in fileserver_data]
    share_sizes = [d['share_size'] for d in fileserver_data]

    plt.figure()
    plt.pie(share_sizes, labels=share_names, autopct='%1.1f%%')
    plt.text(-1.7, -1.5, "hallo du")
    plt.title(f'Share Distribution for {fileserver}')
    pdf_pages.savefig()

pdf_pages.close()
